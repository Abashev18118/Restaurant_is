#!/bin/bash

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ gRPC API –∏ –º–µ—Ç—Ä–∏–∫..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω
echo "üì° –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å gRPC —Å–µ—Ä–≤–µ—Ä–∞..."
nc -z localhost 50052
if [ $? -eq 0 ]; then
    echo "‚úÖ gRPC —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 50052"
else
    echo "‚ùå gRPC —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 50052"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç—Ä–∏–∫–∏..."
curl -s http://localhost:9090/metrics | grep -E "(dish_|grpc_)" || echo "–ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–∫–∞ –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ gRPC –≤—ã–∑–æ–≤–æ–≤)"

echo ""
echo "üîç –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "   grpcurl -plaintext localhost:50052 list"
echo "   grpcurl -plaintext localhost:50052 list v1.MenuService"
echo ""
echo "üìà –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å—É:"
echo "   http://localhost:9090/metrics" 